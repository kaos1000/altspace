!function(){"use strict";function t(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function e(t,e){return e={exports:{}},t(e,e.exports),e.exports}function n(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new AFRAME.THREE.FileLoader;return new Ve(function(n,r){e.load(t,n,function(){},r)})}function r(t,e){var n=new pn(t),r=!0,i=!1,o=void 0;try{for(var a,s=Je(e);!(r=(a=s.next()).done);r=!0){var c=a.value;n.delete(c)}}catch(t){i=!0,o=t}finally{try{!r&&s.return&&s.return()}finally{if(i)throw o}}return n}function i(t,e){return e.reduce(function(e,n){return e[n]=t[n],e},{})}function o(){function t(t,e){console.log("Attempting to get controllers"),(gn=altspace.getGamepads()).length>0?(console.log("Got controllers"),t(gn.filter(function(t){return!!t.hand}))):e()}function e(t,e){function n(){r.removeEventListener("click",n),t()}var r=document.querySelector("a-scene");console.log("waiting for focus"),r.addEventListener("click",n)}function n(e){return new Ve(t).catch(function(){if(--e>0)return new Ve(function(t,e){return setTimeout(t,500)}).then(function(){return n(e)});console.log("Failed to get controllers")})}return altspace.inClient?new Ve(t).catch(function(){return new Ve(e)}).then(function(){return n(20)}):Ve.reject()}var a=e(function(t){!function(e){function n(t,e,n,o){var a=e&&e.prototype instanceof i?e:i,s=Object.create(a.prototype),c=new h(o||[]);return s._invoke=function(t,e,n){var i=A;return function(o,a){if(i===S)throw new Error("Generator is already running");if(i===M){if("throw"===o)throw a;return p()}for(n.method=o,n.arg=a;;){var s=n.delegate;if(s){var c=u(s,n);if(c){if(c===T)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===A)throw i=M,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=S;var l=r(t,e,n);if("normal"===l.type){if(i=n.done?M:x,l.arg===T)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(i=M,n.method="throw",n.arg=l.arg)}}}(t,n,c),s}function r(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}function i(){}function o(){}function a(){}function s(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function c(t){function e(n,i,o,a){var s=r(t[n],t,i);if("throw"!==s.type){var c=s.arg,u=c.value;return u&&"object"==typeof u&&m.call(u,"__await")?Promise.resolve(u.__await).then(function(t){e("next",t,o,a)},function(t){e("throw",t,o,a)}):Promise.resolve(u).then(function(t){c.value=t,o(c)},a)}a(s.arg)}var n;this._invoke=function(t,r){function i(){return new Promise(function(n,i){e(t,r,n,i)})}return n=n?n.then(i,i):i()}}function u(t,e){var n=t.iterator[e.method];if(n===v){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=v,u(t,e),"throw"===e.method))return T;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return T}var i=r(n,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,T;var o=i.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=v),e.delegate=null,T):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,T)}function l(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function f(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function h(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(l,this),this.reset(!0)}function d(t){if(t){var e=t[b];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,r=function e(){for(;++n<t.length;)if(m.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=v,e.done=!0,e};return r.next=r}}return{next:p}}function p(){return{value:v,done:!0}}var v,y=Object.prototype,m=y.hasOwnProperty,g="function"==typeof Symbol?Symbol:{},b=g.iterator||"@@iterator",w=g.asyncIterator||"@@asyncIterator",E=g.toStringTag||"@@toStringTag",_=e.regeneratorRuntime;if(_)t.exports=_;else{(_=e.regeneratorRuntime=t.exports).wrap=n;var A="suspendedStart",x="suspendedYield",S="executing",M="completed",T={},j={};j[b]=function(){return this};var L=Object.getPrototypeOf,k=L&&L(L(d([])));k&&k!==y&&m.call(k,b)&&(j=k);var R=a.prototype=i.prototype=Object.create(j);o.prototype=R.constructor=a,a.constructor=o,a[E]=o.displayName="GeneratorFunction",_.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===o||"GeneratorFunction"===(e.displayName||e.name))},_.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,a):(t.__proto__=a,E in t||(t[E]="GeneratorFunction")),t.prototype=Object.create(R),t},_.awrap=function(t){return{__await:t}},s(c.prototype),c.prototype[w]=function(){return this},_.AsyncIterator=c,_.async=function(t,e,r,i){var o=new c(n(t,e,r,i));return _.isGeneratorFunction(e)?o:o.next().then(function(t){return t.done?t.value:o.next()})},s(R),R[E]="Generator",R[b]=function(){return this},R.toString=function(){return"[object Generator]"},_.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},_.values=d,h.prototype={constructor:h,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=v,this.done=!1,this.delegate=null,this.method="next",this.arg=v,this.tryEntries.forEach(f),!t)for(var e in this)"t"===e.charAt(0)&&m.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=v)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){function e(e,r){return o.type="throw",o.arg=t,n.next=e,r&&(n.method="next",n.arg=v),!!r}if(this.done)throw t;for(var n=this,r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],o=i.completion;if("root"===i.tryLoc)return e("end");if(i.tryLoc<=this.prev){var a=m.call(i,"catchLoc"),s=m.call(i,"finallyLoc");if(a&&s){if(this.prev<i.catchLoc)return e(i.catchLoc,!0);if(this.prev<i.finallyLoc)return e(i.finallyLoc)}else if(a){if(this.prev<i.catchLoc)return e(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return e(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&m.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=e,i?(this.method="next",this.next=i.finallyLoc,T):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),T},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),f(n),T}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;f(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:d(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=v),T}}}}(function(){return this}()||Function("return this")())}),s=function(){return this}()||Function("return this")(),c=s.regeneratorRuntime&&Object.getOwnPropertyNames(s).indexOf("regeneratorRuntime")>=0,u=c&&s.regeneratorRuntime;s.regeneratorRuntime=void 0;var l=a;if(c)s.regeneratorRuntime=u;else try{delete s.regeneratorRuntime}catch(t){s.regeneratorRuntime=void 0}var f=l,h=Math.ceil,d=Math.floor,p=function(t){return isNaN(t=+t)?0:(t>0?d:h)(t)},v=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t},y=e(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}),m=e(function(t){var e=t.exports={version:"2.5.3"};"number"==typeof __e&&(__e=e)}),g=(m.version,function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}),b=function(t,e,n){if(g(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,i){return t.call(e,n,r,i)}}return function(){return t.apply(e,arguments)}},w=function(t){return"object"==typeof t?null!==t:"function"==typeof t},E=function(t){if(!w(t))throw TypeError(t+" is not an object!");return t},_=function(t){try{return!!t()}catch(t){return!0}},A=!_(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),x=y.document,S=w(x)&&w(x.createElement),M=function(t){return S?x.createElement(t):{}},T=!A&&!_(function(){return 7!=Object.defineProperty(M("div"),"a",{get:function(){return 7}}).a}),j=Object.defineProperty,L={f:A?Object.defineProperty:function(t,e,n){if(E(t),e=function(t,e){if(!w(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!w(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!w(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!w(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}(e,!0),E(n),T)try{return j(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},k=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},R=A?function(t,e,n){return L.f(t,e,k(1,n))}:function(t,e,n){return t[e]=n,t},O="prototype",F=function(t,e,n){var r,i,o,a=t&F.F,s=t&F.G,c=t&F.S,u=t&F.P,l=t&F.B,f=t&F.W,h=s?m:m[e]||(m[e]={}),d=h[O],p=s?y:c?y[e]:(y[e]||{})[O];s&&(n=e);for(r in n)(i=!a&&p&&void 0!==p[r])&&r in h||(o=i?p[r]:n[r],h[r]=s&&"function"!=typeof p[r]?n[r]:l&&i?b(o,y):f&&p[r]==o?function(t){var e=function(e,n,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,n)}return new t(e,n,r)}return t.apply(this,arguments)};return e[O]=t[O],e}(o):u&&"function"==typeof o?b(Function.call,o):o,u&&((h.virtual||(h.virtual={}))[r]=o,t&F.R&&d&&!d[r]&&R(d,r,o)))};F.F=1,F.G=2,F.S=4,F.P=8,F.B=16,F.W=32,F.U=64,F.R=128;var D=F,P=R,C={}.hasOwnProperty,I=function(t,e){return C.call(t,e)},B={},N={}.toString,G=function(t){return N.call(t).slice(8,-1)},U=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==G(t)?t.split(""):Object(t)},W=function(t){return U(v(t))},H=Math.min,z=function(t){return t>0?H(p(t),9007199254740991):0},V=Math.max,q=Math.min,Q="__core-js_shared__",K=y[Q]||(y[Q]={}),J=function(t){return K[t]||(K[t]={})},Y=0,X=Math.random(),Z=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++Y+X).toString(36))},$=J("keys"),tt=function(t){return $[t]||($[t]=Z(t))},et=function(t){return function(e,n,r){var i,o=W(e),a=z(o.length),s=function(t,e){return(t=p(t))<0?V(t+e,0):q(t,e)}(r,a);if(t&&n!=n){for(;a>s;)if((i=o[s++])!=i)return!0}else for(;a>s;s++)if((t||s in o)&&o[s]===n)return t||s||0;return!t&&-1}}(!1),nt=tt("IE_PROTO"),rt="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(","),it=Object.keys||function(t){return function(t,e){var n,r=W(t),i=0,o=[];for(n in r)n!=nt&&I(r,n)&&o.push(n);for(;e.length>i;)I(r,n=e[i++])&&(~et(o,n)||o.push(n));return o}(t,rt)},ot=A?Object.defineProperties:function(t,e){E(t);for(var n,r=it(e),i=r.length,o=0;i>o;)L.f(t,n=r[o++],e[n]);return t},at=y.document,st=at&&at.documentElement,ct=tt("IE_PROTO"),ut=function(){},lt="prototype",ft=function(){var t,e=M("iframe"),n=rt.length;for(e.style.display="none",st.appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),ft=t.F;n--;)delete ft[lt][rt[n]];return ft()},ht=Object.create||function(t,e){var n;return null!==t?(ut[lt]=E(t),n=new ut,ut[lt]=null,n[ct]=t):n=ft(),void 0===e?n:ot(n,e)},dt=e(function(t){var e=J("wks"),n=y.Symbol,r="function"==typeof n;(t.exports=function(t){return e[t]||(e[t]=r&&n[t]||(r?n:Z)("Symbol."+t))}).store=e}),pt=L.f,vt=dt("toStringTag"),yt=function(t,e,n){t&&!I(t=n?t:t.prototype,vt)&&pt(t,vt,{configurable:!0,value:e})},mt={};R(mt,dt("iterator"),function(){return this});var gt=function(t){return Object(v(t))},bt=tt("IE_PROTO"),wt=Object.prototype,Et=Object.getPrototypeOf||function(t){return t=gt(t),I(t,bt)?t[bt]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?wt:null},_t=dt("iterator"),At=!([].keys&&"next"in[].keys()),xt="values",St=function(){return this},Mt=function(t,e,n,r,i,o,a){!function(t,e,n){t.prototype=ht(mt,{next:k(1,n)}),yt(t,e+" Iterator")}(n,e,r);var s,c,u,l=function(t){if(!At&&t in p)return p[t];switch(t){case"keys":case xt:return function(){return new n(this,t)}}return function(){return new n(this,t)}},f=e+" Iterator",h=i==xt,d=!1,p=t.prototype,v=p[_t]||p["@@iterator"]||i&&p[i],y=!At&&v||l(i),m=i?h?l("entries"):y:void 0,g="Array"==e?p.entries||v:v;if(g&&(u=Et(g.call(new t)))!==Object.prototype&&u.next&&yt(u,f,!0),h&&v&&v.name!==xt&&(d=!0,y=function(){return v.call(this)}),a&&(At||d||!p[_t])&&R(p,_t,y),B[e]=y,B[f]=St,i)if(s={values:h?y:l(xt),keys:o?y:l("keys"),entries:m},a)for(c in s)c in p||P(p,c,s[c]);else D(D.P+D.F*(At||d),e,s);return s},Tt=function(t){return function(e,n){var r,i,o=String(v(e)),a=p(n),s=o.length;return a<0||a>=s?t?"":void 0:(r=o.charCodeAt(a))<55296||r>56319||a+1===s||(i=o.charCodeAt(a+1))<56320||i>57343?t?o.charAt(a):r:t?o.slice(a,a+2):i-56320+(r-55296<<10)+65536}}(!0);Mt(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,n=this._i;return n>=e.length?{value:void 0,done:!0}:(t=Tt(e,n),this._i+=t.length,{value:t,done:!1})});var jt=function(t,e){return{value:e,done:!!t}};Mt(Array,"Array",function(t,e){this._t=W(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,n=this._i++;return!t||n>=t.length?(this._t=void 0,jt(1)):"keys"==e?jt(0,n):"values"==e?jt(0,t[n]):jt(0,[n,t[n]])},"values");B.Arguments=B.Array;for(var Lt=dt("toStringTag"),kt="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),Rt=0;Rt<kt.length;Rt++){var Ot=kt[Rt],Ft=y[Ot],Dt=Ft&&Ft.prototype;Dt&&!Dt[Lt]&&R(Dt,Lt,Ot),B[Ot]=B.Array}var Pt,Ct,It,Bt=dt("toStringTag"),Nt="Arguments"==G(function(){return arguments}()),Gt=function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),Bt))?n:Nt?G(e):"Object"==(r=G(e))&&"function"==typeof e.callee?"Arguments":r},Ut=function(t,e,n,r){if(!(t instanceof e)||void 0!==r&&r in t)throw TypeError(n+": incorrect invocation!");return t},Wt=function(t,e,n,r){try{return r?e(E(n)[0],n[1]):e(n)}catch(e){var i=t.return;throw void 0!==i&&E(i.call(t)),e}},Ht=dt("iterator"),zt=Array.prototype,Vt=function(t){return void 0!==t&&(B.Array===t||zt[Ht]===t)},qt=dt("iterator"),Qt=m.getIteratorMethod=function(t){if(void 0!=t)return t[qt]||t["@@iterator"]||B[Gt(t)]},Kt=e(function(t){var e={},n={},r=t.exports=function(t,r,i,o,a){var s,c,u,l,f=a?function(){return t}:Qt(t),h=b(i,o,r?2:1),d=0;if("function"!=typeof f)throw TypeError(t+" is not iterable!");if(Vt(f)){for(s=z(t.length);s>d;d++)if((l=r?h(E(c=t[d])[0],c[1]):h(t[d]))===e||l===n)return l}else for(u=f.call(t);!(c=u.next()).done;)if((l=Wt(u,h,c.value,r))===e||l===n)return l};r.BREAK=e,r.RETURN=n}),Jt=dt("species"),Yt=function(t,e){var n,r=E(t).constructor;return void 0===r||void 0==(n=E(r)[Jt])?e:g(n)},Xt=y.process,Zt=y.setImmediate,$t=y.clearImmediate,te=y.MessageChannel,ee=y.Dispatch,ne=0,re={},ie="onreadystatechange",oe=function(){var t=+this;if(re.hasOwnProperty(t)){var e=re[t];delete re[t],e()}},ae=function(t){oe.call(t.data)};Zt&&$t||(Zt=function(t){for(var e=[],n=1;arguments.length>n;)e.push(arguments[n++]);return re[++ne]=function(){!function(t,e,n){var r=void 0===n;switch(e.length){case 0:return r?t():t.call(n);case 1:return r?t(e[0]):t.call(n,e[0]);case 2:return r?t(e[0],e[1]):t.call(n,e[0],e[1]);case 3:return r?t(e[0],e[1],e[2]):t.call(n,e[0],e[1],e[2]);case 4:return r?t(e[0],e[1],e[2],e[3]):t.call(n,e[0],e[1],e[2],e[3])}t.apply(n,e)}("function"==typeof t?t:Function(t),e)},Pt(ne),ne},$t=function(t){delete re[t]},"process"==G(Xt)?Pt=function(t){Xt.nextTick(b(oe,t,1))}:ee&&ee.now?Pt=function(t){ee.now(b(oe,t,1))}:te?(It=(Ct=new te).port2,Ct.port1.onmessage=ae,Pt=b(It.postMessage,It,1)):y.addEventListener&&"function"==typeof postMessage&&!y.importScripts?(Pt=function(t){y.postMessage(t+"","*")},y.addEventListener("message",ae,!1)):Pt=ie in M("script")?function(t){st.appendChild(M("script"))[ie]=function(){st.removeChild(this),oe.call(t)}}:function(t){setTimeout(b(oe,t,1),0)});var se={set:Zt,clear:$t},ce=se.set,ue=y.MutationObserver||y.WebKitMutationObserver,le=y.process,fe=y.Promise,he="process"==G(le),de={f:function(t){return new function(t){var e,n;this.promise=new t(function(t,r){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=r}),this.resolve=g(e),this.reject=g(n)}(t)}},pe=function(t){try{return{e:!1,v:t()}}catch(t){return{e:!0,v:t}}},ve=function(t,e){if(E(t),w(e)&&e.constructor===t)return e;var n=de.f(t);return(0,n.resolve)(e),n.promise},ye=function(t,e,n){for(var r in e)n&&t[r]?t[r]=e[r]:R(t,r,e[r]);return t},me=dt("species"),ge=function(t){var e="function"==typeof m[t]?m[t]:y[t];A&&e&&!e[me]&&L.f(e,me,{configurable:!0,get:function(){return this}})},be=dt("iterator"),we=!1;try{[7][be]().return=function(){we=!0}}catch(t){}var Ee,_e,Ae,xe,Se=function(t,e){if(!e&&!we)return!1;var n=!1;try{var r=[7],i=r[be]();i.next=function(){return{done:n=!0}},r[be]=function(){return i},t(r)}catch(t){}return n},Me=se.set,Te=function(){var t,e,n,r=function(){var r,i;for(he&&(r=le.domain)&&r.exit();t;){i=t.fn,t=t.next;try{i()}catch(r){throw t?n():e=void 0,r}}e=void 0,r&&r.enter()};if(he)n=function(){le.nextTick(r)};else if(!ue||y.navigator&&y.navigator.standalone)if(fe&&fe.resolve){var i=fe.resolve();n=function(){i.then(r)}}else n=function(){ce.call(y,r)};else{var o=!0,a=document.createTextNode("");new ue(r).observe(a,{characterData:!0}),n=function(){a.data=o=!o}}return function(r){var i={fn:r,next:void 0};e&&(e.next=i),t||(t=i,n()),e=i}}(),je="Promise",Le=y.TypeError,ke=y.process,Re=y[je],Oe="process"==Gt(ke),Fe=function(){},De=_e=de.f,Pe=!!function(){try{var t=Re.resolve(1),e=(t.constructor={})[dt("species")]=function(t){t(Fe,Fe)};return(Oe||"function"==typeof PromiseRejectionEvent)&&t.then(Fe)instanceof e}catch(t){}}(),Ce=function(t){var e;return!(!w(t)||"function"!=typeof(e=t.then))&&e},Ie=function(t,e){if(!t._n){t._n=!0;var n=t._c;Te(function(){for(var r=t._v,i=1==t._s,o=0,a=function(e){var n,o,a=i?e.ok:e.fail,s=e.resolve,c=e.reject,u=e.domain;try{a?(i||(2==t._h&&Ge(t),t._h=1),!0===a?n=r:(u&&u.enter(),n=a(r),u&&u.exit()),n===e.promise?c(Le("Promise-chain cycle")):(o=Ce(n))?o.call(n,s,c):s(n)):c(r)}catch(t){c(t)}};n.length>o;)a(n[o++]);t._c=[],t._n=!1,e&&!t._h&&Be(t)})}},Be=function(t){Me.call(y,function(){var e,n,r,i=t._v,o=Ne(t);if(o&&(e=pe(function(){Oe?ke.emit("unhandledRejection",i,t):(n=y.onunhandledrejection)?n({promise:t,reason:i}):(r=y.console)&&r.error&&r.error("Unhandled promise rejection",i)}),t._h=Oe||Ne(t)?2:1),t._a=void 0,o&&e.e)throw e.v})},Ne=function(t){return 1!==t._h&&0===(t._a||t._c).length},Ge=function(t){Me.call(y,function(){var e;Oe?ke.emit("rejectionHandled",t):(e=y.onrejectionhandled)&&e({promise:t,reason:t._v})})},Ue=function(t){var e=this;e._d||(e._d=!0,(e=e._w||e)._v=t,e._s=2,e._a||(e._a=e._c.slice()),Ie(e,!0))},We=function(t){var e,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===t)throw Le("Promise can't be resolved itself");(e=Ce(t))?Te(function(){var r={_w:n,_d:!1};try{e.call(t,b(We,r,1),b(Ue,r,1))}catch(t){Ue.call(r,t)}}):(n._v=t,n._s=1,Ie(n,!1))}catch(t){Ue.call({_w:n,_d:!1},t)}}};Pe||(Re=function(t){Ut(this,Re,je,"_h"),g(t),Ee.call(this);try{t(b(We,this,1),b(Ue,this,1))}catch(t){Ue.call(this,t)}},(Ee=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=ye(Re.prototype,{then:function(t,e){var n=De(Yt(this,Re));return n.ok="function"!=typeof t||t,n.fail="function"==typeof e&&e,n.domain=Oe?ke.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&Ie(this,!1),n.promise},catch:function(t){return this.then(void 0,t)}}),Ae=function(){var t=new Ee;this.promise=t,this.resolve=b(We,t,1),this.reject=b(Ue,t,1)},de.f=De=function(t){return t===Re||t===xe?new Ae(t):_e(t)}),D(D.G+D.W+D.F*!Pe,{Promise:Re}),yt(Re,je),ge(je),xe=m[je],D(D.S+D.F*!Pe,je,{reject:function(t){var e=De(this);return(0,e.reject)(t),e.promise}}),D(D.S+!0*D.F,je,{resolve:function(t){return ve(this===xe?Re:this,t)}}),D(D.S+D.F*!(Pe&&Se(function(t){Re.all(t).catch(Fe)})),je,{all:function(t){var e=this,n=De(e),r=n.resolve,i=n.reject,o=pe(function(){var n=[],o=0,a=1;Kt(t,!1,function(t){var s=o++,c=!1;n.push(void 0),a++,e.resolve(t).then(function(t){c||(c=!0,n[s]=t,--a||r(n))},i)}),--a||r(n)});return o.e&&i(o.v),n.promise},race:function(t){var e=this,n=De(e),r=n.reject,i=pe(function(){Kt(t,!1,function(t){e.resolve(t).then(n.resolve,r)})});return i.e&&r(i.v),n.promise}}),D(D.P+D.R,"Promise",{finally:function(t){var e=Yt(this,m.Promise||y.Promise),n="function"==typeof t;return this.then(n?function(n){return ve(e,t()).then(function(){return n})}:t,n?function(n){return ve(e,t()).then(function(){throw n})}:t)}}),D(D.S,"Promise",{try:function(t){var e=de.f(this),n=pe(t);return(n.e?e.reject:e.resolve)(n.v),e.promise}});var He=m.Promise,ze=e(function(t){t.exports={default:He,__esModule:!0}}),Ve=t(ze),qe=t(e(function(t,e){e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(ze);e.default=function(t){return function(){var e=t.apply(this,arguments);return new n.default(function(t,r){function i(o,a){try{var s=e[o](a),c=s.value}catch(t){return void r(t)}if(!s.done)return n.default.resolve(c).then(function(t){i("next",t)},function(t){i("throw",t)});t(c)}return i("next")})}}}));AFRAME.registerComponent("place-for-space",{schema:{templates:{default:[]},mixins:{default:[]},otherwise:{default:""}},init:function(){var t=qe(f.mark(function t(){var e,n;return f.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!altspace.inClient){t.next=6;break}return t.next=3,altspace.getSpace();case 3:t.t0=t.sent,t.next=7;break;case 6:t.t0={};case 7:e=t.t0,console.log(e),(n=this.data.templates.indexOf(e.templateSid))>=0?this.el.setAttribute("mixin",this.data.mixins[n]):this.el.setAttribute("mixin",this.data.otherwise);case 11:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()}),AFRAME.registerComponent("library-page",{schema:{service:{type:"string",default:"poly"},page:{type:"int",default:0}},update:function(){var t=qe(f.mark(function t(e){var n;return f.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.el.emit("pageupdatestart"),t.prev=1,n=this.el.sceneEl.hasAttribute("debug")?"fakeGetListing":"getListing",t.next=5,this.el.sceneEl.systems[this.data.service+"-service"][n](this.data.page);case 5:this.currentPage=t.sent,t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),console.error(t.t0.stack);case 11:this.el.emit("pageupdateend");case 12:case"end":return t.stop()}},t,this,[[1,8]])}));return function(e){return t.apply(this,arguments)}}()}),AFRAME.registerComponent("library-item",{schema:{type:"int"},init:function(){this.itemData=null,this.el.parentElement.addEventListener("pageupdatestart",this.showLoading.bind(this)),this.el.parentElement.addEventListener("pageupdateend",this.updateContents.bind(this)),this.el.addEventListener("materialtextureloaded",this.updateDimensions.bind(this)),this.el.addEventListener("click",this.previewItem.bind(this))},showLoading:function(){this.el.setAttribute("color","#555")},updateContents:function(){this.itemData=this.el.parentElement.components["library-page"].currentPage.assets[this.data],this.itemData&&this.el.setAttribute("src",this.itemData.thumbnail.url)},updateDimensions:function(){var t=this.el.object3DMap.mesh.material.map,e=t&&t.image&&"IMG"===t.image.tagName?t.image:{width:1,height:1},n=e.width/e.height;n>1?this.el.setAttribute("scale",{x:1,y:1/n,z:1}):this.el.setAttribute("scale",{x:n,y:1,z:1}),this.itemData&&this.el.setAttribute("color","#fff")},previewItem:function(){var t=document.querySelector("#spawn"),e=this.itemData.formats.filter(function(t){return"GLTF2"===t.formatType});t.components.spawner.setSpawn("model-gltf",e[0].root.url,"https://poly.google.com/view/"+this.itemData.name.slice(7))}}),AFRAME.registerComponent("library-advance",{schema:{type:"int"},init:function(){this.active=!1,this.el.addEventListener("click",this.advance.bind(this)),this.el.parentElement.addEventListener("pageupdateend",this.updatePaging.bind(this))},advance:function(){if(this.active){var t=this.el.parentElement,e=t.getAttribute("library-page").page;t.setAttribute("library-page","page",e+this.data)}},updatePaging:function(){var t=this.el.parentElement.components["library-page"];this.el.sceneEl.systems["poly-service"].pages[t.data.page+this.data]||this.data>0&&t.currentPage.nextPageToken?(this.el.setAttribute("avr-visible",!0),this.active=!0,console.log("advance "+this.data+": shown")):(this.el.setAttribute("avr-visible",!1),this.active=!1,console.log("advance "+this.data+": hidden"))}});var Qe=m.getIterator=function(t){var e=Qt(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return E(e.call(t))},Ke=e(function(t){t.exports={default:Qe,__esModule:!0}}),Je=t(Ke),Ye=e(function(t){var e=Z("meta"),n=L.f,r=0,i=Object.isExtensible||function(){return!0},o=!_(function(){return i(Object.preventExtensions({}))}),a=function(t){n(t,e,{value:{i:"O"+ ++r,w:{}}})},s=t.exports={KEY:e,NEED:!1,fastKey:function(t,n){if(!w(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!I(t,e)){if(!i(t))return"F";if(!n)return"E";a(t)}return t[e].i},getWeak:function(t,n){if(!I(t,e)){if(!i(t))return!0;if(!n)return!1;a(t)}return t[e].w},onFreeze:function(t){return o&&s.NEED&&i(t)&&!I(t,e)&&a(t),t}}}),Xe=(Ye.KEY,Ye.NEED,Ye.fastKey,Ye.getWeak,Ye.onFreeze,function(t,e){if(!w(t)||t._t!==e)throw TypeError("Incompatible receiver, "+e+" required!");return t}),Ze=L.f,$e=Ye.fastKey,tn=A?"_s":"size",en=function(t,e){var n,r=$e(e);if("F"!==r)return t._i[r];for(n=t._f;n;n=n.n)if(n.k==e)return n},nn={getConstructor:function(t,e,n,r){var i=t(function(t,o){Ut(t,i,e,"_i"),t._t=e,t._i=ht(null),t._f=void 0,t._l=void 0,t[tn]=0,void 0!=o&&Kt(o,n,t[r],t)});return ye(i.prototype,{clear:function(){for(var t=Xe(this,e),n=t._i,r=t._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];t._f=t._l=void 0,t[tn]=0},delete:function(t){var n=Xe(this,e),r=en(n,t);if(r){var i=r.n,o=r.p;delete n._i[r.i],r.r=!0,o&&(o.n=i),i&&(i.p=o),n._f==r&&(n._f=i),n._l==r&&(n._l=o),n[tn]--}return!!r},forEach:function(t){Xe(this,e);for(var n,r=b(t,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(t){return!!en(Xe(this,e),t)}}),A&&Ze(i.prototype,"size",{get:function(){return Xe(this,e)[tn]}}),i},def:function(t,e,n){var r,i,o=en(t,e);return o?o.v=n:(t._l=o={i:i=$e(e,!0),k:e,v:n,p:r=t._l,n:void 0,r:!1},t._f||(t._f=o),r&&(r.n=o),t[tn]++,"F"!==i&&(t._i[i]=o)),t},getEntry:en,setStrong:function(t,e,n){Mt(t,e,function(t,n){this._t=Xe(t,e),this._k=n,this._l=void 0},function(){for(var t=this._k,e=this._l;e&&e.r;)e=e.p;return this._t&&(this._l=e=e?e.n:this._t._f)?"keys"==t?jt(0,e.k):"values"==t?jt(0,e.v):jt(0,[e.k,e.v]):(this._t=void 0,jt(1))},n?"entries":"values",!n,!0),ge(e)}},rn=Array.isArray||function(t){return"Array"==G(t)},on=dt("species"),an=function(t,e){return new(function(t){var e;return rn(t)&&("function"!=typeof(e=t.constructor)||e!==Array&&!rn(e.prototype)||(e=void 0),w(e)&&null===(e=e[on])&&(e=void 0)),void 0===e?Array:e}(t))(e)},sn=L.f,cn=function(t,e){var n=1==t,r=2==t,i=3==t,o=4==t,a=6==t,s=5==t||a,c=e||an;return function(e,u,l){for(var f,h,d=gt(e),p=U(d),v=b(u,l,3),y=z(p.length),m=0,g=n?c(e,y):r?c(e,0):void 0;y>m;m++)if((s||m in p)&&(f=p[m],h=v(f,m,d),t))if(n)g[m]=h;else if(h)switch(t){case 3:return!0;case 5:return f;case 6:return m;case 2:g.push(f)}else if(o)return!1;return a?-1:i||o?o:g}}(0),un=function(t,e,n,r,i,o){var a=y[t],s=a,c=i?"set":"add",u=s&&s.prototype,l={};return A&&"function"==typeof s&&(o||u.forEach&&!_(function(){(new s).entries().next()}))?(s=e(function(e,n){Ut(e,s,t,"_c"),e._c=new a,void 0!=n&&Kt(n,i,e[c],e)}),cn("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(t){var e="add"==t||"set"==t;t in u&&(!o||"clear"!=t)&&R(s.prototype,t,function(n,r){if(Ut(this,s,t),!e&&o&&!w(n))return"get"==t&&void 0;var i=this._c[t](0===n?0:n,r);return e?this:i})}),o||sn(s.prototype,"size",{get:function(){return this._c.size}})):(s=r.getConstructor(e,t,i,c),ye(s.prototype,n),Ye.NEED=!0),yt(s,t),l[t]=s,D(D.G+D.W+D.F,l),o||r.setStrong(s,t,i),s},ln=(un("Set",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return nn.def(Xe(this,"Set"),t=0===t?0:t,t)}},nn),function(t){return function(){if(Gt(this)!=t)throw TypeError(t+"#toJSON isn't generic");return function(t,e){var n=[];return Kt(t,!1,n.push,n,e),n}(this)}});D(D.P+D.R,"Set",{toJSON:ln("Set")});var fn=function(t){D(D.S,t,{of:function(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];return new this(e)}})};fn("Set");var hn=function(t){D(D.S,t,{from:function(t){var e,n,r,i,o=arguments[1];return g(this),(e=void 0!==o)&&g(o),void 0==t?new this:(n=[],e?(r=0,i=b(o,arguments[2],2),Kt(t,!1,function(t){n.push(i(t,r++))})):Kt(t,!1,n.push,n),new this(n))}})};hn("Set");var dn=m.Set,pn=t(e(function(t){t.exports={default:dn,__esModule:!0}})),vn=new AFRAME.THREE.Vector3,yn=new AFRAME.THREE.Quaternion,mn=new AFRAME.THREE.Vector3;AFRAME.registerSystem("poly-service",{schema:{key:{type:"string"}},init:function(){this.pages=[],this.loader=new AFRAME.THREE.FileLoader,this.query="https://poly.googleapis.com/v1/assets/?format=GLTF2&maxComplexity=SIMPLE&pageSize=20&key="+this.data.key},getListing:function(){var t=qe(f.mark(function t(e){var r,i,o,a,s;return f.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("attemping grab of page",e),!(e<0)){t.next=3;break}throw new Error("Requested page ("+e+") before beginning");case 3:if(!this.pages[e]){t.next=7;break}return t.abrupt("return",this.pages[e]);case 7:if(0!==e){t.next=16;break}return t.next=10,n(this.query,this.loader);case 10:return r=t.sent,i=JSON.parse(r),this.pages.push(i),t.abrupt("return",i);case 16:return o={},t.prev=17,t.next=20,this.getListing(e-1);case 20:o=t.sent,t.next=27;break;case 23:throw t.prev=23,t.t0=t.catch(17),console.log(t.t0.stack),new Error("Requested page ("+e+") past end, no previous page");case 27:if(!o.nextPageToken){t.next=36;break}return t.next=30,n(this.query+"&pageToken="+o.nextPageToken,this.loader);case 30:return a=t.sent,s=JSON.parse(a),this.pages.push(s),t.abrupt("return",s);case 36:throw new Error("Requested page ("+e+") past end, no page token");case 37:case"end":return t.stop()}},t,this,[[17,23]])}));return function(e){return t.apply(this,arguments)}}(),fakeGetListing:function(){var t=qe(f.mark(function t(e){var r;return f.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n("testdata/listing.json",this.loader);case 2:return r=t.sent,t.abrupt("return",JSON.parse(r));case 4:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()}),AFRAME.registerComponent("avr-visible",{schema:{type:"boolean",default:!1},init:function(){this.el.addEventListener("model-loaded",this.update.bind(this))},update:function(){var t=this;console.log("visible update:",this.data),this.el.object3D.traverse(function(e){return e.visible=t.data})}});AFRAME.registerComponent("hover-scale",{init:function(){var t=this;this.el.setAttribute("animation__hover",{startEvents:["hoverstart","mouseleave"],property:"scale",dir:"alternate",easing:"easeOutQuad",dur:200}),this.el.addEventListener("mouseenter",function(){var e=function(t,e){return e.map(function(e){return t[e]})}(t.el.getAttribute("scale"),["x","y","z"]),n=e.map(function(t){return 1.2*t});t.el.setAttribute("animation__hover",{from:e.join(" "),to:n.join(" ")}),t.el.emit("hoverstart")})}}),AFRAME.registerComponent("maintain-size",{schema:{type:"vec3"},init:function(){this.el.addEventListener("model-loaded",this.rescale.bind(this))},rescale:function(){this.el.setAttribute("position",{x:0,y:0,z:0}),this.el.setAttribute("scale",{x:1,y:1,z:1});var t=new AFRAME.THREE.Box3;t.setFromObject(this.el.object3D);var e=t.getSize(),n=this.el.object3D.worldToLocal(t.getCenter()),r=Math.min(this.data.x/e.x,this.data.y/e.y,this.data.z/e.z);this.el.setAttribute("scale",{x:r,y:r,z:r}),this.el.setAttribute("position",n.multiplyScalar(-r)),this.el.components.collision&&this.el.components.collision.updateTransform()}});var gn=[],bn=null;AFRAME.registerComponent("altspace-controls",{schema:{default:"right"},init:function(){var t=qe(f.mark(function t(){var e,n=this;return f.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.gamepad=null,this.parentInverse=(new THREE.Matrix4).getInverse(this.el.parentElement.object3D.matrixWorld),bn||(bn=o()),!(gn.length>0)){t.next=7;break}t.t0=gn,t.next=10;break;case 7:return t.next=9,bn;case 9:t.t0=t.sent;case 10:e=t.t0,this.gamepad=e.filter(function(t){return t.hand===n.data})[0],this.gamepad||console.log("No "+this.data+"-hand controller found");case 13:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}(),tick:function(){this.gamepad&&(this.el.object3D.position.copy(this.gamepad.position).applyMatrix4(this.parentInverse),this.el.object3D.quaternion.copy(this.gamepad.rotation),!this.gripState&&this.gamepad.buttons[1].pressed?(this.gripState=!0,this.el.emit("gripdown",this.el,!1)):this.gripState&&!this.gamepad.buttons[1].pressed&&(this.gripState=!1,this.el.emit("gripup",this.el,!1)))}});var wn=new AFRAME.THREE.Matrix4;AFRAME.registerComponent("grabbable",{dependencies:["sync"],schema:{enabled:{default:!0}},init:function(){this.grabber=null,this.localTransform=new AFRAME.THREE.Matrix4,this._hoverStart=this.hoverStart.bind(this),this._pickup=this.pickup.bind(this),this._drop=this.drop.bind(this),this._hoverEnd=this.hoverEnd.bind(this),this.sync=this.el.components.sync,this.sync.isConnected?this.spawnPickup():this.el.addEventListener("connected",this.spawnPickup.bind(this))},update:function(){this.data.enabled?(this.el.addEventListener("collision-start",this._hoverStart),this.el.addEventListener("collision-end",this._hoverEnd)):(this.el.removeEventListener("collision-start",this._hoverStart),this.el.removeEventListener("collision-end",this._hoverEnd))},hoverStart:function(t){t.detail.addEventListener("gripdown",this._pickup)},pickup:function(t){var e=t.detail;this.grabber=e,e.object3D.updateMatrixWorld(!0),this.el.object3D.updateMatrixWorld(!0),this.localTransform.getInverse(e.object3D.matrixWorld).multiply(this.el.object3D.matrixWorld),this.el.setAttribute("collision","kinematic",!0),e.addEventListener("gripup",this._drop)},drop:function(t){var e=t.detail;this.grabber===e&&(this.grabber=null,this.el.setAttribute("collision","kinematic",!1))},hoverEnd:function(t){t.detail.removeEventListener("gripdown",this._pickup)},tick:function(){this.grabber&&(this.grabber.object3D.updateMatrixWorld(!0),function(t,e){e.decompose(vn,yn,mn),t.setAttribute("position",vn),t.setAttribute("quaternion",yn),t.setAttribute("scale",mn)}(this.el,wn.getInverse(this.el.object3D.parent.matrixWorld).multiply(this.grabber.object3D.matrixWorld).multiply(this.localTransform)))},spawnPickup:function(){function t(t){if(t.val()){var n=document.getElementById(t.val());console.log(t.val(),n),e.pickup({detail:n}),e.sync.dataRef.child("spawnClient").remove(),e.sync.dataRef.child("grabber").remove()}}var e=this,n=this.el.sceneEl.systems["sync-system"];e.sync.dataRef.child("spawnClient").on("value",function(r){r.val()===n.clientId&&e.sync.dataRef.child("grabber").on("value",t)})}});var En=function(t,e,n){e in t?L.f(t,e,k(0,n)):t[e]=n};D(D.S+D.F*!Se(function(t){}),"Array",{from:function(t){var e,n,r,i,o=gt(t),a="function"==typeof this?this:Array,s=arguments.length,c=s>1?arguments[1]:void 0,u=void 0!==c,l=0,f=Qt(o);if(u&&(c=b(c,s>2?arguments[2]:void 0,2)),void 0==f||a==Array&&Vt(f))for(n=new a(e=z(o.length));e>l;l++)En(n,l,u?c(o[l],l):o[l]);else for(i=f.call(o),n=new a;!(r=i.next()).done;l++)En(n,l,u?Wt(i,c,[r.value,l],!0):r.value);return n.length=l,n}});var _n=m.Array.from,An=e(function(t){t.exports={default:_n,__esModule:!0}});t(An);var xn=t(e(function(t,e){e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(An);e.default=function(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return(0,n.default)(t)}})),Sn=dt("iterator"),Mn=m.isIterable=function(t){var e=Object(t);return void 0!==e[Sn]||"@@iterator"in e||B.hasOwnProperty(Gt(e))},Tn=e(function(t){t.exports={default:Mn,__esModule:!0}});t(Tn);var jn=t(e(function(t,e){function n(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var r=n(Tn),i=n(Ke);e.default=function(){return function(t,e){if(Array.isArray(t))return t;if((0,r.default)(Object(t)))return function(t,e){var n=[],r=!0,o=!1,a=void 0;try{for(var s,c=(0,i.default)(t);!(r=(s=c.next()).done)&&(n.push(s.value),!e||n.length!==e);r=!0);}catch(t){o=!0,a=t}finally{try{!r&&c.return&&c.return()}finally{if(o)throw a}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()}));un("Map",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{get:function(t){var e=nn.getEntry(Xe(this,"Map"),t);return e&&e.v},set:function(t,e){return nn.def(Xe(this,"Map"),0===t?0:t,e)}},nn,!0);D(D.P+D.R,"Map",{toJSON:ln("Map")}),fn("Map"),hn("Map");var Ln=m.Map,kn=t(e(function(t){t.exports={default:Ln,__esModule:!0}})),Rn=t(e(function(t,e){e.__esModule=!0,e.default=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}}));D(D.S+D.F*!A,"Object",{defineProperty:L.f});var On=m.Object,Fn=function(t,e,n){return On.defineProperty(t,e,n)},Dn=e(function(t){t.exports={default:Fn,__esModule:!0}});t(Dn);var Pn=t(e(function(t,e){e.__esModule=!0;var n=function(t){return t&&t.__esModule?t:{default:t}}(Dn);e.default=function(){function t(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),(0,n.default)(t,i.key,i)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}()})),Cn=function(){function t(){Rn(this,t),this.aToB=new kn,this.bToA=new kn}return Pn(t,[{key:"set",value:function(t,e){var n=this.bToA.get(e),r=this.aToB.get(t);n===t&&r===e||(this.aToB.delete(n),this.bToA.delete(r)),this.aToB.set(t,e),this.bToA.set(e,t)}},{key:"getB",value:function(t){return this.aToB.get(t)}},{key:"getA",value:function(t){return this.bToA.get(t)}},{key:"forEach",value:function(t){return this.bToA.forEach(t)}},{key:"deleteA",value:function(t){this.aToB.get(t)&&(this.bToA.delete(this.aToB.get(t)),this.aToB.delete(t))}},{key:"deleteB",value:function(t){this.bToA.get(t)&&(this.aToB.delete(this.bToA.get(t)),this.bToA.delete(t))}}]),t}(),In=e(function(t){var e=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=e)}),Bn=e(function(t){var e=t.exports={version:"2.5.3"};"number"==typeof __e&&(__e=e)}),Nn=(Bn.version,function(t){return"object"==typeof t?null!==t:"function"==typeof t}),Gn=function(t){if(!Nn(t))throw TypeError(t+" is not an object!");return t},Un=function(t){try{return!!t()}catch(t){return!0}},Wn=!Un(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}),Hn=In.document,zn=Nn(Hn)&&Nn(Hn.createElement),Vn=!Wn&&!Un(function(){return 7!=Object.defineProperty(function(t){return zn?Hn.createElement(t):{}}("div"),"a",{get:function(){return 7}}).a}),qn=Object.defineProperty,Qn={f:Wn?Object.defineProperty:function(t,e,n){if(Gn(t),e=function(t,e){if(!Nn(t))return t;var n,r;if(e&&"function"==typeof(n=t.toString)&&!Nn(r=n.call(t)))return r;if("function"==typeof(n=t.valueOf)&&!Nn(r=n.call(t)))return r;if(!e&&"function"==typeof(n=t.toString)&&!Nn(r=n.call(t)))return r;throw TypeError("Can't convert object to primitive value")}(e,!0),Gn(n),Vn)try{return qn(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(t[e]=n.value),t}},Kn=Wn?function(t,e,n){return Qn.f(t,e,function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}(1,n))}:function(t,e,n){return t[e]=n,t},Jn={}.hasOwnProperty,Yn=function(t,e){return Jn.call(t,e)},Xn=0,Zn=Math.random(),$n=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++Xn+Zn).toString(36))},tr=e(function(t){var e=$n("src"),n=Function.toString,r=(""+n).split("toString");Bn.inspectSource=function(t){return n.call(t)},(t.exports=function(t,n,i,o){var a="function"==typeof i;a&&(Yn(i,"name")||Kn(i,"name",n)),t[n]!==i&&(a&&(Yn(i,e)||Kn(i,e,t[n]?""+t[n]:r.join(String(n)))),t===In?t[n]=i:o?t[n]?t[n]=i:Kn(t,n,i):(delete t[n],Kn(t,n,i)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[e]||n.call(this)})}),er=function(t,e,n){if(function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!")}(t),void 0===e)return t;switch(n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,i){return t.call(e,n,r,i)}}return function(){return t.apply(e,arguments)}},nr=function(t,e,n){var r,i,o,a,s=t&nr.F,c=t&nr.G,u=t&nr.S,l=t&nr.P,f=t&nr.B,h=c?In:u?In[e]||(In[e]={}):(In[e]||{}).prototype,d=c?Bn:Bn[e]||(Bn[e]={}),p=d.prototype||(d.prototype={});c&&(n=e);for(r in n)o=((i=!s&&h&&void 0!==h[r])?h:n)[r],a=f&&i?er(o,In):l&&"function"==typeof o?er(Function.call,o):o,h&&tr(h,r,o,t&nr.U),d[r]!=o&&Kn(d,r,a),l&&p[r]!=o&&(p[r]=o)};In.core=Bn,nr.F=1,nr.G=2,nr.S=4,nr.P=8,nr.B=16,nr.W=32,nr.U=64,nr.R=128;var rr=nr,ir={}.toString,or=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==function(t){return ir.call(t).slice(8,-1)}(t)?t.split(""):Object(t)},ar=function(t){return or(function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}(t))},sr=Math.ceil,cr=Math.floor,ur=function(t){return isNaN(t=+t)?0:(t>0?cr:sr)(t)},lr=Math.min,fr=Math.max,hr=Math.min,dr="__core-js_shared__",pr=In[dr]||(In[dr]={}),vr=e(function(t){var e=function(t){return pr[t]||(pr[t]={})}("wks"),n=In.Symbol,r="function"==typeof n;(t.exports=function(t){return e[t]||(e[t]=r&&n[t]||(r?n:$n)("Symbol."+t))}).store=e})("unscopables"),yr=Array.prototype;void 0==yr[vr]&&Kn(yr,vr,{});var mr=function(t){return function(e,n,r){var i,o=ar(e),a=function(t){return t>0?lr(ur(t),9007199254740991):0}(o.length),s=function(t,e){return(t=ur(t))<0?fr(t+e,0):hr(t,e)}(r,a);if(t&&n!=n){for(;a>s;)if((i=o[s++])!=i)return!0}else for(;a>s;s++)if((t||s in o)&&o[s]===n)return t||s||0;return!t&&-1}}(!0);rr(rr.P,"Array",{includes:function(t){return mr(this,t,arguments.length>1?arguments[1]:void 0)}}),function(t){yr[vr][t]=!0}("includes");Bn.Array.includes;var gr=function(){function t(){Rn(this,t),this._pools={},this._refs=new kn}return Pn(t,[{key:"get",value:function(t){this._pools[t]=this._pools[t]||[];var e=this._pools[t].shift()||new Ammo[t];return this._refs.set(e,t),e}},{key:"getSome",value:function(t,e){for(var n=[],r=0;r<e;r++)n.push(this.get(t));return n}},{key:"done",value:function(){for(var t=this,e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];n.forEach(function(e){var n=t._refs.get(e);t._pools[n]=t._pools[n]||[],t._pools[n].push(e)})}}]),t}();AFRAME.registerSystem("collision",{init:function(){var t=this;this.el2co=new Cn,this.el2localBounds=new kn,this.regQueue=[],this.manifolds=new pn,this.forceUpdateObjects=new pn,this._debugMeshes=new kn,this.ap=new gr,Ammo().then(function(){var e=new Ammo.btDefaultCollisionConfiguration,n=new Ammo.btCollisionDispatcher(e),r=t.ap.getSome("btVector3",2),i=jn(r,2),o=i[0],a=i[1];o.setValue(-100,-100,-100),a.setValue(100,100,100);var s=new Ammo.btAxisSweep3(o,a);t.world=new Ammo.btCollisionWorld(n,s,e),t.ap.done(o,a),t.regQueue.forEach(function(e){return t.registerCollisionBody(e)}),t.regQueue=null})},tick:function(){var t=this;if(this.world){this.el2co.forEach(function(e,n){try{if(!t.forceUpdateObjects.has(e)&&!e.getAttribute("collision").kinematic)return;e.object3D.updateMatrixWorld(!0);var r=t.el2localBounds.get(e),i=e.object3D.localToWorld(r.getCenter()),o=e.object3D.getWorldQuaternion(),a=e.object3D.getWorldScale(),s=n.getWorldTransform(),c=n.getCollisionShape(),u=t.ap.getSome("btVector3",2),l=jn(u,2),f=l[0],h=l[1],d=t.ap.get("btQuaternion");if(f.setValue.apply(f,xn(i.toArray())),d.setValue.apply(d,xn(o.toArray())),h.setValue.apply(h,xn(a.toArray())),s.setOrigin(f),s.setRotation(d),c.setLocalScaling(h),t.ap.done(f,d,h),t.forceUpdateObjects.delete(e),t.el.sceneEl.hasAttribute("debug")&&t._debugMeshes.has(e)){var p=t._debugMeshes.get(e);p.position.copy(i),p.quaternion.copy(o),p.scale.copy(a)}}catch(t){console.error("xfrm update failed:",err,e)}}),this.world.performDiscreteCollisionDetection();for(var e=this.world.getDispatcher(),n=e.getNumManifolds(),i=new pn,o=0;o<n;o++){var a=e.getManifoldByIndexInternal(o);a.getNumContacts()>0&&i.add(a)}try{var s=r(i,this.manifolds),c=!0,u=!1,l=void 0;try{for(var f,h=Je(s);!(c=(f=h.next()).done);c=!0){var d=f.value,p=d.getBody0(),v=d.getBody1(),y=this.el2co.getA(p),m=this.el2co.getA(v);if(y&&m){var g=y.getAttribute("collision").with,b=m.getAttribute("collision").with;g.includes(m)&&b.includes(y)&&(m.emit("collision-start",y,!1),y.emit("collision-start",m,!1))}}}catch(t){u=!0,l=t}finally{try{!c&&h.return&&h.return()}finally{if(u)throw l}}}catch(t){console.error("coll-start failed:",t)}try{var w=r(this.manifolds,i),E=!0,_=!1,A=void 0;try{for(var x,S=Je(w);!(E=(x=S.next()).done);E=!0){var M=x.value,T=M.getBody0(),j=M.getBody1(),L=this.el2co.getA(T),k=this.el2co.getA(j);if(L&&k){var R=[].concat(xn(L.getAttribute("collision").with)),O=[].concat(xn(k.getAttribute("collision").with));R.includes(k)&&O.includes(L)&&(k.emit("collision-end",L,!1),L.emit("collision-end",k,!1))}}}catch(t){_=!0,A=t}finally{try{!E&&S.return&&S.return()}finally{if(_)throw A}}}catch(t){console.error("coll-end failed:",t)}this.manifolds=i}},registerCollisionBody:function(t){if(this.world){var e=new AFRAME.THREE.Box3;e.setFromObject(t.object3DMap.mesh);var n=(new THREE.Matrix4).getInverse(t.object3D.matrixWorld);e.applyMatrix4(n),this.el2localBounds.set(t,e);var r=e.getSize(),i=new Ammo.btVector3(r.x/2,r.y/2,r.z/2),o=new Ammo.btCollisionObject;if(o.setCollisionShape(new Ammo.btBoxShape(i)),this.el2co.set(t,o),this.world.addCollisionObject(o),this.el.sceneEl.hasAttribute("debug")){var a=new THREE.Mesh(new THREE.BoxBufferGeometry(r.x,r.y,r.z),new THREE.MeshBasicMaterial({color:"magenta",transparent:!0,opacity:.2}));this._debugMeshes.set(t,a),this.el.sceneEl.object3D.add(a)}}else this.regQueue.push(t)},removeCollisionBody:function(t){var e=this.el2co.getB(t);this.world.removeCollisionObject(e),this.el2co.deleteA(t),this.el.sceneEl.hasAttribute("debug")&&(this.el.sceneEl.object3D.remove(this._debugMeshes.get(t)),this._debugMeshes.delete(t))},isRegistered:function(t){return!!this.el2co.getB(t)},forceUpdateTransform:function(t){this.forceUpdateObjects.add(t)}}),AFRAME.registerComponent("collision",{schema:{with:{type:"selectorAll"},kinematic:{type:"boolean",default:!1}},init:function(){this.el.object3DMap.mesh&&this.updateBounds(),this.el.addEventListener("model-loaded",this.updateBounds.bind(this))},update:function(t){if(t.kinematic&&!this.data.kinematic&&this.system.forceUpdateTransform(this.el),!function(t,e){return t&&e&&t.length===e.length&&t.every(function(t,n){return t===e[n]})}(t.with,this.data.with)){var e=!0,n=!1,r=void 0;try{for(var i,o=Je(this.data.with);!(e=(i=o.next()).done);e=!0){var a=i.value;a!==this.el&&a.components&&a.components.collision&&(console.log("updating collider of",a.id),a.components.collision.updateProperties())}}catch(t){n=!0,r=t}finally{try{!e&&o.return&&o.return()}finally{if(n)throw r}}}},updateBounds:function(){this.system.isRegistered(this.el)&&this.system.removeCollisionBody(this.el),this.system.registerCollisionBody(this.el),this.updateTransform()},updateTransform:function(){this.system.forceUpdateTransform(this.el)},remove:function(){this.system.removeCollisionBody(this.el)}}),AFRAME.registerComponent("grab-indicator",{init:function(){var t=this;this.el.setAttribute("color","white"),this.el.addEventListener("collision-start",function(){t.el.setAttribute("color","yellow")}),this.el.addEventListener("collision-end",function(){t.el.setAttribute("color","white")})}}),AFRAME.registerComponent("spawner",{schema:{enabled:{default:!0},spawnTarget:{type:"selector",default:"#decor"}},init:function(){this._hoverStart=this.hoverStart.bind(this),this._hoverEnd=this.hoverEnd.bind(this),this.handlers=new kn,this.syncSys=this.el.sceneEl.systems["sync-system"],this.activeItem=null,this.el.sceneEl.hasAttribute("debug")&&this.setSpawn("model-gltf","https://poly.googleapis.com/downloads/428MKgODp0H/aDT46ikQ6r4/Seal_01.gltf","https://poly.google.com/view/428MKgODp0H")},update:function(){if(this.data.enabled)this.el.addEventListener("collision-start",this._hoverStart),this.el.addEventListener("collision-end",this._hoverEnd);else{this.el.removeEventListener("collision-start",this._hoverStart),this.el.removeEventListener("collision-end",this._hoverEnd);var t=!0,e=!1,n=void 0;try{for(var r,i=Je(this.handlers);!(t=(r=i.next()).done);t=!0){var o=r.value,a=jn(o,2),s=a[0];a[1];this.hoverEnd({detail:s})}}catch(t){e=!0,n=t}finally{try{!t&&i.return&&i.return()}finally{if(e)throw n}}}},hoverStart:function(t){var e=t.detail,n=this.spawn(e);this.handlers.set(e,n),e.addEventListener("gripdown",n)},spawn:function(t){var e=this;return function(){if(e.syncSys.isConnected){var n={instantiatorId:"",groupName:"main",mixin:"decoration",parent:e.attrValue.spawnTarget||"#decor",creatorUserId:e.syncSys.userInfo.userId,clientId:e.syncSys.clientId},r=e.syncSys.instantiatedElementsRef.child(n.groupName).push(n),o=e.syncSys.sceneRef.child("main-instance-"+r.key()).child("data");e.data.spawnTarget.object3D.updateMatrixWorld(!0),e.el.object3D.updateMatrixWorld(!0);var a=(new AFRAME.THREE.Matrix4).getInverse(e.data.spawnTarget.object3D.matrixWorld).multiply(e.el.object3D.matrixWorld),s=new AFRAME.THREE.Vector3,c=new AFRAME.THREE.Quaternion,u=new AFRAME.THREE.Euler,l=new AFRAME.THREE.Vector3;a.decompose(s,c,l),u=u.setFromQuaternion(c).toVector3().multiplyScalar(180/Math.PI),o.child("position").set(i(s,["x","y","z"])),o.child("rotation").set(i(u,["x","y","z"])),o.child("scale").set(i(l,["x","y","z"])),o.child("type").set(e.activeItem.type),o.child("srcUrl").set(e.activeItem.srcUrl),o.child("moreInfoUrl").set(e.activeItem.moreInfoUrl),o.child("spawnClient").set(e.syncSys.clientId),o.child("grabber").set(t.id),e.el.setAttribute("spawner","enabled",!1)}else console.error("Spawner: sync system not yet connected, cannot spawn.")}},hoverEnd:function(t){var e=t.detail;e.removeEventListener("gripdown",this.handlers.get(e)),this.handlers.delete(e),this.el.setAttribute("spawner","enabled",!0)},setSpawn:function(t,e,n){this.activeItem={type:t,srcUrl:e,moreInfoUrl:n},"model-gltf"===t&&this.el.setAttribute("gltf-model",e)}}),AFRAME.registerComponent("set-from-data",{schema:{from:{type:"string"},to:{type:"array"}},multiple:!0,update:function(){var t;(t=this.el).setAttribute.apply(t,xn(this.data.to).concat([this.el.dataset[this.data.from]]))}}),AFRAME.registerComponent("quaternion",{schema:{type:"vec4"},update:function(){var t=(new AFRAME.THREE.Euler).setFromQuaternion(this.data,"YZX").toVector3().multiplyScalar(180/Math.PI);this.el.setAttribute("rotation",t)}}),AFRAME.registerComponent("decor-sync",{init:function(){this.queuedInstantiations=[],this.syncSys=this.el.sceneEl.systems["sync-system"],this.el.sceneEl.addEventListener("connected",this.connected.bind(this))},connected:function(){this.instances=this.syncSys.connection.space.child("decorations"),this.instances.on("child_added",this.listenToInstanceGroup.bind(this)),this.instances.on("child_removed",this.stopListeningToInstanceGroup.bind(this))},listenToInstanceGroup:function(t){t.ref().on("child_added",this.createDecoration.bind(this)),t.ref().on("child_removed",this.removeDecoration.bind(this))},stopListeningToInstanceGroup:function(t){t.ref().off("child_added"),t.ref().off("child_removed")},createDecoration:function(t){t.val(),t.key()},removeDecoration:function(t){var e=t.key(),n=this.el.querySelector("#"+e);n.parentNode.removeChild(n)},processQueuedInstantiations:function(){var t=this;this.queuedInstantiations.forEach(function(e){t.instances.push(e).onDisconnect().remove()}),this.queuedInstantiations.length=0},instantiate:function(t,e){this.queuedInstantiations.push({}),this.syncSys.connected&&this.processQueuedInstantiations()}});AFRAME.registerComponent("sync-src",{dependencies:["sync"],init:function(){var t=this;this.currentData={type:"",srcUrl:"",moreInfoUrl:""},this.sync=this.el.components.sync,this.el.addEventListener("click",function(){t.currentData.moreInfoUrl&&altspace.open(t.currentData.moreInfoUrl)}),this.sync.isConnected?this.init2():this.el.addEventListener("connected",this.init2.bind(this))},init2:function(){var t=this,e=function(t,e,n){function r(){var u=Date.now()-s;u<e&&u>=0?i=setTimeout(r,e-u):(i=null,n||(c=t.apply(a,o),a=o=null))}var i,o,a,s,c;null==e&&(e=100);var u=function(){a=this,o=arguments,s=Date.now();var u=n&&!i;return i||(i=setTimeout(r,e)),u&&(c=t.apply(a,o),a=o=null),c};return u.clear=function(){i&&(clearTimeout(i),i=null)},u.flush=function(){i&&(c=t.apply(a,o),a=o=null,clearTimeout(i),i=null)},u}(function(){"model-gltf"===t.currentData.type&&t.el.setAttribute("gltf-model",t.currentData.srcUrl)},150),n=this.sync.dataRef.child("type"),r=this.sync.dataRef.child("srcUrl"),i=this.sync.dataRef.child("moreInfoUrl");n.on("value",function(n){t.currentData.type||(t.currentData.type=n.val(),e())}),r.on("value",function(n){t.currentData.srcUrl||(t.currentData.srcUrl=n.val(),e())}),i.on("value",function(e){t.currentData.moreInfoUrl||(t.currentData.moreInfoUrl=e.val())})}}),AFRAME.registerComponent("if-mod",{schema:{type:"string",default:""},init:function(){var t=this.el.sceneEl.systems["sync-system"],e=function(){t.userInfo.isModerator&&this.el.setAttribute("mixin",this.data+" "+this.el.getAttribute("mixin"))}.bind(this);t.isConnected?e():this.el.sceneEl.addEventListener("connected",e)}})}();
//# sourceMappingURL=bundle.min.js.map
//# sourceMappingURL=bundle.min.js.map
